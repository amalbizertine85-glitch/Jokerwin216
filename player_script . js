// JSONBIN CONFIG
const BIN_ID = "692eeefbae596e708f7e9e72";
const API_KEY = "$2a$10$hCALb9EdUjLfi38M4RhCMOdm8.1y36yYtLvW0BYdZTfqjpHtlAY7S";

async function fetchUsers() {
    const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
        headers: { "X-Master-Key": API_KEY }
    });
    const data = await res.json();
    return data.record.users || {};
}

async function saveUsers(users) {
    await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
        method: "PUT",
        headers: {
            "Content-Type": "application/json",
            "X-Master-Key": API_KEY
        },
        body: JSON.stringify({ users })
    });
}

async function login() {
    let user = document.getElementById("username").value.trim();
    let pass = document.getElementById("password").value.trim();

    const users = await fetchUsers();

    if (!users[user]) {
        alert("User not found");
        return;
    }
    if (users[user].password !== pass) {
        alert("Wrong password");
        return;
    }

    localStorage.setItem("player", user);
    window.location.href = "player_home.html";
}

async function loadBalance() {
    const user = localStorage.getItem("player");
    if (!user) return;

    const users = await fetchUsers();
    const bal = users[user]?.balance || 0;

    document.getElementById("balance").innerText = bal + " TD";
}

function logout() {
    localStorage.removeItem("player");
    window.location.href = "player_login.html";
}

if (window.location.pathname.includes("player_home.html")) {
    loadBalance();
}
