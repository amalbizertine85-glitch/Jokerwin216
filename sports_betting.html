<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Sport Betting</title>
<style>
  body { font-family: Arial, sans-serif; background:#121212; color:#fff; }
  h1,h2 { color:#1a5e1a; }
  .league { margin-bottom:20px; }
  .match { display:flex; justify-content:space-between; background:#1a1a1a; padding:10px; margin:5px 0; border-radius:5px; }
  .odds button { margin:0 3px; padding:5px 8px; cursor:pointer; border:none; border-radius:3px; background:#4caf50; color:#fff; }
  .popup { display:none; position:fixed; top:10%; left:50%; transform:translateX(-50%); background:#222; padding:20px; width:450px; max-height:80%; overflow-y:auto; border-radius:10px; box-shadow:0 0 15px #000; z-index:100; }
  .popup h3 { margin-top:0; color:#1a5e1a; }
  .popup .bet-item { display:flex; justify-content:space-between; margin:5px 0; padding:5px; background:#333; border-radius:5px; }
  .popup .bet-item button { background:red; color:#fff; border:none; border-radius:3px; cursor:pointer; }
  #overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:50; }
  .historique { margin-top:15px; border-top:1px solid #555; padding-top:10px; max-height:150px; overflow-y:auto; }
  input[type=number] { width:80px; padding:3px; }
</style>
</head>
<body>

<h1>Sport Betting</h1>

<div id="matches-container">
  <!-- Serie A -->
  <div class="league">
    <h2>Serie A</h2>
    <div class="match" data-league="Serie A" data-teams="As Rome vs Como">
      <span>As Rome vs Como</span>
      <div class="odds">
        <button data-type="1X2" data-value="1">1</button>
        <button data-type="1X2" data-value="X">X</button>
        <button data-type="1X2" data-value="2">2</button>
        <button data-type="Over/Under" data-value="Over2.5">O2.5</button>
        <button data-type="Over/Under" data-value="Under2.5">U2.5</button>
        <button data-type="GG/NG" data-value="GG">GG</button>
        <button data-type="GG/NG" data-value="NG">NG</button>
        <button data-type="CorrectScore" data-value="1-0">CS 1-0</button>
        <button data-type="CorrectScore" data-value="2-1">CS 2-1</button>
        <button data-type="Handicap" data-value="+1">H +1</button>
        <button data-type="Handicap" data-value="-1">H -1</button>
      </div>
    </div>
  </div>

  <!-- La Liga -->
  <div class="league">
    <h2>La Liga</h2>
    <div class="match" data-league="La Liga" data-teams="Vallecano vs Betis">
      <span>Vallecano vs Betis</span>
      <div class="odds">
        <button data-type="1X2" data-value="1">1</button>
        <button data-type="1X2" data-value="X">X</button>
        <button data-type="1X2" data-value="2">2</button>
        <button data-type="Over/Under" data-value="Over2.5">O2.5</button>
        <button data-type="Over/Under" data-value="Under2.5">U2.5</button>
        <button data-type="GG/NG" data-value="GG">GG</button>
        <button data-type="GG/NG" data-value="NG">NG</button>
        <button data-type="CorrectScore" data-value="1-0">CS 1-0</button>
        <button data-type="CorrectScore" data-value="2-1">CS 2-1</button>
        <button data-type="Handicap" data-value="+1">H +1</button>
        <button data-type="Handicap" data-value="-1">H -1</button>
      </div>
    </div>
  </div>

  <!-- Premier League -->
  <div class="league">
    <h2>Premier League</h2>
    <div class="match" data-league="Premier League" data-teams="Man United vs Bournemouth">
      <span>Man United vs Bournemouth</span>
      <div class="odds">
        <button data-type="1X2" data-value="1">1</button>
        <button data-type="1X2" data-value="X">X</button>
        <button data-type="1X2" data-value="2">2</button>
        <button data-type="Over/Under" data-value="Over2.5">O2.5</button>
        <button data-type="Over/Under" data-value="Under2.5">U2.5</button>
        <button data-type="GG/NG" data-value="GG">GG</button>
        <button data-type="GG/NG" data-value="NG">NG</button>
        <button data-type="CorrectScore" data-value="1-0">CS 1-0</button>
        <button data-type="CorrectScore" data-value="2-1">CS 2-1</button>
        <button data-type="Handicap" data-value="+1">H +1</button>
        <button data-type="Handicap" data-value="-1">H -1</button>
      </div>
    </div>
  </div>
</div>

<button onclick="openPopup()">فتح Popup الرهانات</button>

<div id="overlay"></div>
<div class="popup" id="bet-popup">
  <h3>رهاناتك</h3>
  <div id="selected-bets"></div>
  <div style="margin-top:10px;">
    <label>المبلغ: </label>
    <input type="number" id="bet-amount" min="1" value="1">
    <button onclick="confirmBets()">تأكيد الرهانات</button>
  </div>
  <h4>Historique des paris</h4>
  <div class="historique" id="bet-history"></div>
  <button onclick="closePopup()">إغلاق</button>
</div>

<script>
// بيانات اللاعب الأولية
let user = {username:"player1", balance:100, bets:[], history:[]};
let selectedBets = [];

// JSONBin
const BIN = "692eeefbae596e708f7e9e72";
const KEY = "$2a$10$hCALb9EdUjLfi38M4RhCMOdm8.1y36yYtLvW0BYdZTfqjpHtlAY7S";

// فتح وإغلاق Popup
function openPopup(){
  document.getElementById('overlay').style.display='block';
  document.getElementById('bet-popup').style.display='block';
  renderSelectedBets();
  renderHistory();
}
function closePopup(){
  document.getElementById('overlay').style.display='none';
  document.getElementById('bet-popup').style.display='none';
}

// إضافة رهانات عند اختيار الأودز
document.querySelectorAll('.odds button').forEach(btn=>{
  btn.addEventListener('click',()=>{
    let matchDiv = btn.closest('.match');
    let match = matchDiv.dataset.teams;
    let league = matchDiv.dataset.league;
    let type = btn.dataset.type;
    let value = btn.dataset.value;

    if(!selectedBets.find(b=>b.match===match && b.type===type)){
      selectedBets.push({match, league, type, value});
    }
    openPopup();
  });
});

// عرض الرهانات المختارة
function renderSelectedBets(){
  let container = document.getElementById('selected-bets');
  container.innerHTML='';
  selectedBets.forEach((b,i)=>{
    let div = document.createElement('div');
    div.className='bet-item';
    div.innerHTML=`${b.match} - ${b.type}: ${b.value} <button onclick="removeBet(${i})">×</button>`;
    container.appendChild(div);
  });
}

// حذف رهان
function removeBet(index){
  selectedBets.splice(index,1);
  renderSelectedBets();
}

// تأكيد الرهانات وربط الرصيد + JSONBin
async function confirmBets(){
  let amount = parseFloat(document.getElementById('bet-amount').value);
  if(selectedBets.length===0){ alert('اختر مباراة أولاً'); return; }
  if(amount>user.balance){ alert('رصيدك لا يكفي'); return; }

  selectedBets.forEach(b=>{
    user.bets.push({...b, amount});
    user.history.push({...b, amount, timestamp:new Date().toLocaleString()});
    user.balance -= amount;
  });
  selectedBets=[];

  renderSelectedBets();
  renderHistory();
  alert('تم تسجيل الرهانات. رصيدك الحالي: ' + user.balance);

  // تحديث JSONBin
  try{
    await fetch(`https://api.jsonbin.io/v3/b/${BIN}`,{
      method:'PUT',
      headers:{
        'Content-Type':'application/json',
        'X-Master-Key': KEY,
        'X-Bin-Versioning':'false'
      },
      body: JSON.stringify(user)
    });
  }catch(e){ console.error('خطأ في تحديث JSONBin', e); }
}

// تحميل البيانات من JSONBin عند فتح الصفحة
async function loadUserData(){
  try{
    let res = await fetch(`https://api.jsonbin.io/v3/b/${BIN}/latest`,{
      headers:{'X-Master-Key':KEY}
    });
    if(res.ok){
      let data = await res.json();
      if(data.record) user = data.record;
    }
  }catch(e){ console.error('خطأ في تحميل JSONBin', e); }
}
loadUserData();
</script>
</body>
    </html>
