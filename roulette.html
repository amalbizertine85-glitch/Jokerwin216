<!doctype html>

<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>JOKER216 — Roulette Professionnelle</title>
<style>
  :root{
    --bg:#071718;
    --panel:#0b2b26;
    --accent:#00ff73;
    --muted:rgba(255,255,255,0.6);
    --card-radius:14px;
  }
  *{box-sizing:border-box}
  body{margin:0; font-family:Inter, Noto Sans, Tahoma, sans-serif; background:linear-gradient(180deg,#041514 0%,#071718 100%); color:#fff}header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:rgba(0,0,0,0.16);border-bottom:1px solid rgba(255,255,255,0.04)} header .left{display:flex;align-items:center;gap:12px} header img.logo{height:44px;cursor:pointer} #playerBlock{font-weight:700;text-align:right} #playerBlock small{display:block;font-weight:400;color:var(--muted);font-size:12px}

.wrap{max-width:1200px;margin:18px auto;padding:0 14px} .game-area{display:grid;grid-template-columns:540px 1fr;gap:18px}

/* WHEEL */ .wheel-card{background:var(--panel);border-radius:var(--card-radius);padding:18px} .wheel-outer{width:420px;height:420px;margin:0 auto;position:relative} .wheel{width:100%;height:100%;border-radius:50%;overflow:hidden;border:8px solid #0f3b33;box-shadow:0 10px 30px rgba(0,0,0,0.6);transition:transform 4s cubic-bezier(.2,.9,.2,1)} .wheel .sector{position:absolute;left:50%;top:50%;transform-origin:0 0;width:50%;height:50%;} .pointer{position:absolute;left:50%;top:-8px;transform:translateX(-50%);width:0;height:0;border-left:14px solid transparent;border-right:14px solid transparent;border-bottom:26px solid #ffecb3;z-index:20}

/* BOARD */ .board-card{background:var(--panel);border-radius:var(--card-radius);padding:18px;display:flex;flex-direction:column;gap:12px} .bets{display:flex;gap:10px;align-items:center} .chips{display:flex;gap:10px} .chip{padding:8px 12px;background:rgba(255,255,255,0.06);border-radius:10px;cursor:pointer;border:1px solid rgba(255,255,255,0.04)} .chip.active{background:linear-gradient(180deg,#ffd24a,#ffb400);color:#000;font-weight:800}

.bet-controls{display:flex;gap:10px;align-items:center} .btn{padding:10px 14px;border-radius:10px;border:0;background:#00b050;color:#fff;font-weight:800;cursor:pointer} .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06)}

.bets-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px} .bets-grid button{padding:14px;border-radius:10px;border:0;background:rgba(255,255,255,0.03);color:var(--muted);cursor:pointer}

.log{font-size:14px;color:var(--muted);min-height:42px}

.result-bubble{margin-top:10px;background:rgba(0,0,0,0.3);padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.04)}

footer{max-width:1200px;margin:28px auto;color:var(--muted);text-align:center}

@media(max-width:980px){ .game-area{grid-template-columns:1fr;} .wheel-outer{width:320px;height:320px} } </style>

</head>
<body>
<header>
  <div class="left"><img src="joker216-logo.png" class="logo" id="logoBtn" alt="logo"></div>
  <div id="playerBlock"> <span id="pName">Guest</span> <small id="pBal">—</small></div>
</header><div class="wrap">
  <div class="game-area"><div class="wheel-card">
  <div style="text-align:center;margin-bottom:12px;font-weight:800">Roulette — européenne (0-36)</div>
  <div class="wheel-outer">
    <div class="pointer"></div>
    <div id="wheel" class="wheel"></div>
  </div>
  <div style="display:flex;justify-content:center;margin-top:12px;gap:8px">
    <button class="btn" id="spinBtn">SPIN</button>
    <button class="btn ghost" id="clearBet">Clear</button>
  </div>
  <div class="result-bubble" id="resultBox">Place your bet and spin.</div>
</div>

<div class="board-card">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <div style="font-weight:800">Controle des mises</div>
    <div style="text-align:right">Balance: <span id="balanceDisplay">0</span> TND</div>
  </div>

  <div class="bets">
    <div class="chips" id="chips">
      <div class="chip" data-value="0.2">0.2</div>
      <div class="chip" data-value="1">1</div>
      <div class="chip" data-value="5">5</div>
      <div class="chip" data-value="10">10</div>
    </div>
    <div class="bet-controls">
      <div>Selected Bet: <strong id="selectedBet">—</strong></div>
      <div style="width:8px"></div>
    </div>
  </div>

  <div style="margin-top:10px">
    <div style="font-weight:700;margin-bottom:6px">Bet Types rapide</div>
    <div class="bets-grid">
      <button data-type="red">Red (payout 1:1)</button>
      <button data-type="black">Black (1:1)</button>
      <button data-type="odd">Odd (1:1)</button>
      <button data-type="even">Even (1:1)</button>
      <button data-type="low">1-18 (1:1)</button>
      <button data-type="high">19-36 (1:1)</button>
    </div>
  </div>

  <div style="margin-top:12px">
    <div style="font-weight:700;margin-bottom:6px">Logs</div>
    <div class="log" id="logArea">—</div>
  </div>

</div>

  </div>
</div><footer>Roulette demo • Code open • Built for Joker216</footer><script>
// --- CONFIG ---
const BIN_ID = "692eeefbae596e708f7e9e72"; // ضع BIN هنا لو تحب
const API_KEY = "$2a$10$hCALb9EdUjLfi38M4RhCMOdm8.1y36yYtLvW0BYdZTfqjpHtlAY7S"; // ضع KEY هنا (اختياري)

// --- DATA ---
const wheel = document.getElementById('wheel');
const spinBtn = document.getElementById('spinBtn');
const clearBtn = document.getElementById('clearBet');
const resultBox = document.getElementById('resultBox');
const balanceDisplay = document.getElementById('balanceDisplay');
const pNameEl = document.getElementById('pName');
const pBalEl = document.getElementById('pBal');
const logArea = document.getElementById('logArea');

let user = JSON.parse(localStorage.getItem('loggedUser')) || { username: 'Guest', balance: 50 };
let selectedChip = null;
let currentBets = []; // {type:'red'|'number', value:amount, number:?}

// roulette numbers order (European wheel clockwise starting at 0)
const numbers = [0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26];
const reds = new Set([32,19,21,25,34,27,36,30,23,5,16,1,14,9,18,7,12,3]);

// build wheel sectors
function buildWheel(){
  wheel.innerHTML = '';
  const slice = 360 / numbers.length;
  numbers.forEach((num,i)=>{
    const el = document.createElement('div');
    el.className = 'sector';
    const angle = i * slice;
    el.style.transform = `rotate(${angle}deg) translate(-50%, -100%)`;
    el.innerHTML = `<div style="transform:rotate(${slice/2}deg) translate(60%) ; position:absolute; left:0; top:0; font-weight:700; font-size:14px;">${num}</div>`;
    wheel.appendChild(el);
  });
}

buildWheel();

// show user info
function refreshUserUI(){
  pNameEl.textContent = user.username || 'Guest';
  balanceDisplay.textContent = Number(user.balance).toFixed(2);
  pBalEl.textContent = (user.balance!==undefined)? (user.balance.toFixed? user.balance.toFixed(2)+" TND": user.balance+" TND") : '';
}
refreshUserUI();

// chips
document.getElementById('chips').addEventListener('click', (e)=>{
  const chip = e.target.closest('.chip');
  if(!chip) return;
  document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
  chip.classList.add('active');
  selectedChip = parseFloat(chip.dataset.value);
  document.getElementById('selectedBet').textContent = selectedChip + ' TND';
});

// quick bets
document.querySelectorAll('.bets-grid button').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    if(!selectedChip){ alert('Choose a chip first'); return; }
    const type = btn.dataset.type;
    placeBet({type, value:selectedChip});
  });
});

function placeBet(bet){
  // check funds
  if(user.balance < bet.value){ alert('رصيدك لا يكفي'); return; }
  user.balance -= bet.value;
  currentBets.push(bet);
  refreshUserUI();
  appendLog(`Bet placed: ${bet.type || 'number '+bet.number} — ${bet.value} TND`);
}

function appendLog(txt){
  logArea.textContent = txt + '\n' + logArea.textContent;
}

clearBtn.addEventListener('click', ()=>{
  // refund bets
  currentBets.forEach(b=>{ user.balance += b.value; });
  currentBets = [];
  refreshUserUI();
  appendLog('Bets cleared');
});

spinBtn.addEventListener('click', ()=>{
  if(currentBets.length===0){ alert('Place at least one bet'); return; }
  startSpin();
});

let spinning = false;
async function startSpin(){
  if(spinning) return;
  spinning = true;
  spinBtn.disabled = true;
  appendLog('Spinning...');

  // pick random winning number
  const winIndex = Math.floor(Math.random()*numbers.length);
  const winNumber = numbers[winIndex];

  // compute rotation so that winIndex lands at pointer (top)
  const slice = 360 / numbers.length;
  const targetAngle = (360 * 5) + (360 - (winIndex * slice) - slice/2); // add multiple turns

  wheel.style.transition = 'transform 5s cubic-bezier(.2,.9,.2,1)';
  wheel.style.transform = `rotate(${targetAngle}deg)`;

  // await end
  await new Promise(r=> setTimeout(r,5200));

  // settle bets
  settle(winNumber);

  // reset
  wheel.style.transition = '';
  spinning = false;
  spinBtn.disabled = false;
}

function settle(win){
  appendLog('Result: ' + win);
  let totalWin = 0;
  currentBets.forEach(b=>{
    if(b.type === 'red'){
      if(reds.has(win)) totalWin += b.value * 2; // payout 1:1 -> return + win
    } else if(b.type === 'black'){
      if(!reds.has(win) && win!==0) totalWin += b.value * 2;
    } else if(b.type === 'odd'){
      if(win!==0 && win%2===1) totalWin += b.value * 2;
    } else if(b.type === 'even'){
      if(win!==0 && win%2===0) totalWin += b.value * 2;
    } else if(b.type === 'low'){
      if(win>=1 && win<=18) totalWin += b.value * 2;
    } else if(b.type === 'high'){
      if(win>=19 && win<=36) totalWin += b.value * 2;
    } else if(b.type === 'number'){
      if(b.number === win) totalWin += b.value * 36; // straight up 35:1 + stake
    }
  });

  if(totalWin>0){
    user.balance += totalWin;
    appendLog(`You won ${totalWin.toFixed(2)} TND`);
    resultBox.textContent = `Result: ${win} — Vous gagnez ${totalWin.toFixed(2)} TND`;
  } else {
    resultBox.textContent = `Result: ${win} — Pas de gain`; 
  }

  // clear bets
  currentBets = [];
  refreshUserUI();

  // OPTIONAL: update remote JSONBin (PATCH) if you use JSONBin to store balances
  // if(BIN_ID && API_KEY){ updateRemoteBalance(user.username, user.balance); }
}

// Example function to PATCH JSONBin record (uncomment to use)
async function updateRemoteBalance(username, newBalance){
  try{
    // fetch current
    const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`,{
      headers: { 'X-Master-Key': API_KEY, 'Content-Type': 'application/json' },
      method: 'GET'
    });
    const data = await res.json();
    const record = data.record || {};
    if(!record.users) record.users = {};
    if(!record.users[username]) record.users[username] = {};
    record.users[username].balance = newBalance;

    // patch
    await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`,{
      method: 'PUT', // or PATCH depending on your bin setup. Many prefer PUT to replace the record.
      headers: { 'X-Master-Key': API_KEY, 'Content-Type': 'application/json' },
      body: JSON.stringify(record)
    });
    appendLog('Remote balance updated');
  }catch(e){
    appendLog('Failed to update remote balance');
  }
}

// logo click returns to player_home
document.getElementById('logoBtn').addEventListener('click', ()=> location.href='player_home.html');

// ---- init: if loggedUser in localStorage take it -- otherwise guest ----
(function init(){
  const u = JSON.parse(localStorage.getItem('loggedUser'));
  if(u && u.username){ user = u; }
  refreshUserUI();
})();

</script></body>
</html>
